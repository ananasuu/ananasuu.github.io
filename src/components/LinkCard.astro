---
import { getLocaleFromUrl, getLocalizedContent } from '../utils/i18n/i18n';

const {linkCategory} = Astro.props;
const locale = getLocaleFromUrl(Astro.url.pathname);

let links = [];
if (linkCategory === 'helpful') {
  links = await import('../data/creative/helpful.json').then(m => m.default);
} else if (linkCategory === 'tool') {
  links = await import('../data/creative/tools.json').then(m => m.default);
}

// Liste der Bilder, die eine AVIF-Version haben
const hasAvif = new Set([
  '/assets/img/tool_img/ears.avif',
  '/assets/img/tool_img/maidband.avif'
]);
---

<ul class="infolinks">
    {links.map((link) => {
        const localizedLink = getLocalizedContent(link, locale);
        const ext = localizedLink.imageUrl.match(/\.(jpg|jpeg|png|svg|avif)$/i)?.[1]?.toLowerCase();
        const isJpg = ext === 'jpg' || ext === 'jpeg';
        const avifUrl = localizedLink.imageUrl.replace(/\.(jpg|jpeg)$/i, '.avif');
        const shouldUseAvif = isJpg && hasAvif.has(avifUrl);
        return (
            <li>
                <a class="infocard link" href={localizedLink.url}>
                <h3>{localizedLink.title}</h3>
                <p class="use">{localizedLink.use}</p>
                <picture>
                  {shouldUseAvif && <source srcset={avifUrl} type="image/avif" />}
                  <img src={localizedLink.imageUrl} alt={localizedLink.title} loading="lazy" />
                </picture>
                <p>{localizedLink.description}</p>
            </a>
            </li>
        );
    })}
</ul>
